<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignments</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #f4f7fa 0%, #257dbb 100%);
            --card-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --card-shadow-hover: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            --border-radius: 0.75rem;
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
        background-color: #ffffff !important;
        box-shadow: var(--card-shadow);
        backdrop-filter: blur(10px);
      }

      .navbar-brand img {
        height: 40px;
        width: auto;
      }

      .navbar-dark .navbar-nav .nav-link {
        color: black;
        font-weight: 500;
        border-radius: 0.375rem;
        transition: all 0.3s ease;
        margin: 0 0.25rem;
      }
      .navbar-dark .navbar-nav .nav-link:hover,
      .navbar-dark .navbar-nav .nav-link.active {
        color: #257dbb !important;
        transform: translateY(-2px);
      }

        .navbar-toggler {
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
        }

        .navbar-toggler:focus {
            box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25);
        }

        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.9%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }

        .assignment-mode {
            background: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #257dbb;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .assignment-mode:hover {
            background: #257dbb;
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            color: #ffffff;
        }

        .search-tabs-section {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            margin: 2rem 0;
        }

        .search-tabs-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .search-input-group {
            flex: 1;
            min-width: 250px;
            position: relative;
            max-width: 400px;
        }

        .search-input-group .form-control {
            border-radius: 50px;
            padding: 0.75rem 1.5rem 0.75rem 3rem;
            border: 2px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .search-input-group .form-control:focus {
            border-color: #257dbb;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .search-input-group .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            z-index: 10;
        }

        .tabs-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: #257dbb transparent;
            flex: 1;
            min-width: 0;
        }

        .tabs-container::-webkit-scrollbar {
            height: 6px;
        }

        .tabs-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .tabs-container::-webkit-scrollbar-thumb {
            background: #257dbb;
            border-radius: 3px;
        }

        .status-btn {
            border-radius: 25px;
            padding: 0.5rem 1rem;
            border: 2px solid #dee2e6;
            background: transparent;
            color: #495057;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 100px;
        }

        .status-btn.active,
        .status-btn:hover {
            background: #f5911f;
            border-color: #f5911f;
            color: white;
            transform: translateY(-2px);
        }

        .assignment-card {
            background: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }

        .assignment-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #007bff, #0056b3);
        }

        .assignment-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow-hover);
        }

        .assignment-card.overdue {
            border-left: 5px solid #dc3545;
        }

        .assignment-card.completed {
            border-left: 5px solid #28a745;
        }

        .assignment-card h3 {
            color: #212529;
            font-weight: 600;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .assignment-status {
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            display: inline-block;
        }

        .status-pending { 
            background: #fff3cd; 
            color: #856404; 
            border: 1px solid #ffeaa7; 
        }

        .status-in-progress { 
            background: #d1ecf1; 
            color: #0c5460; 
            border: 1px solid #bee5eb; 
        }

        .status-completed { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }

        .status-overdue { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }

        .priority {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .priority.high { color: #dc3545; }
        .priority.medium { color: #ffc107; }
        .priority.low { color: #28a745; }

        .deadline {
            color: #6c757d;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .deadline.overdue { color: #dc3545; font-weight: 600; }

        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-pending { background: #ffc107; }
        .progress-in-progress { background: #007bff; }
        .progress-completed { background: #28a745; }
        .progress-overdue { background: #dc3545; }

        .assignment-actions {
            margin-top: auto;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-view { background: #007bff; color: white; }
        .btn-view:hover { background: #0056b3; transform: translateY(-1px); }

        .btn-mark-done { background: #28a745; color: white; }
        .btn-mark-done:hover { background: #218838; transform: translateY(-1px); }

        .assignment-date {
            color: #6c757d;
            font-size: 0.8rem;
            margin-top: auto;
            margin-bottom: 0.5rem;
        }

        .status-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.2rem;
            opacity: 0.7;
        }

        .status-icon.pending { color: #ffc107; }
        .status-icon.in-progress { color: #007bff; }
        .status-icon.completed { color: #28a745; }
        .status-icon.overdue { color: #dc3545; }

        .modal-header {
            background: var(--primary-gradient);
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            border: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header .btn-close {
            display: none !important;
        }

        .deadline-warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .deadline-warning i {
            font-size: 1.2rem;
            margin-right: 0.5rem;
        }

        .assignment-question {
            background: #f8f9fa;
            border-left: 4px solid #257dbb;
            padding: 1.25rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .submitted-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .submitted-message i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .mark-done-btn-modal {
            background: #28a745;
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
        }

        .mark-done-btn-modal:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .mark-done-btn-modal:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 991.98px) {
            .navbar-collapse {
                margin-top: 0.75rem;
                box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            }
            .assignment-mode {
                margin-top: 0.5rem;
                width: 100%;
            }
            .search-tabs-container {
                flex-direction: column;
                align-items: stretch;
            }
            .search-input-group {
                max-width: none;
                margin-bottom: 1rem;
            }
        }

        @media (max-width: 768px) {
            .search-tabs-section { 
                padding: 1rem; 
                margin: 1rem 0; 
            }
            .search-input-group .form-control {
                font-size: 0.9rem;
                padding: 0.625rem 1rem 0.625rem 2.5rem;
            }
            .status-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
                min-width: 90px;
            }
            .assignment-card { padding: 1.25rem; }
            .assignment-actions { justify-content: center; }
        }

        @media (max-width: 576px) {
            .assignment-card { padding: 1rem; }
            .assignment-card h3 { font-size: 1rem; }
            .status-btn { 
                padding: 0.35rem 0.6rem; 
                font-size: 0.8rem; 
                min-width: 80px; 
            }
            .btn-action { 
                padding: 0.3rem 0.6rem; 
                font-size: 0.8rem; 
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="./logo.webp" alt="Logo" class="me-2">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="notes.html"><i class="fas fa-file-alt me-1"></i> Notes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="courses.html"><i class="fas fa-book me-1"></i> Courses</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="assignments.html"><i class="fas fa-clipboard-list me-1"></i> Assignments</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="calendar.html"><i class="fas fa-calendar-alt me-1"></i> Calendar</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html"><i class="fas fa-user-circle me-1"></i> Profile</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <button class="assignment-mode btn ms-3" data-bs-toggle="modal" data-bs-target="#assignmentModal">
                        <i class="fas fa-tasks me-1"></i> Assignment Mode
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid px-3 px-lg-4" style="padding-top: 80px;">
        <!-- Single Row Search + Status Tabs -->
        <section class="search-tabs-section">
            <div class="search-tabs-container">
                <div class="search-input-group">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="form-control" id="searchInput" 
                           placeholder="🔍 Search assignments by title, course, or keywords..." autocomplete="off">
                </div>
                <div class="tabs-container" id="statusButtons">
                    <button type="button" class="status-btn active" data-status="all">
                        <i class="fas fa-list me-1"></i>All
                    </button>
                    <button type="button" class="status-btn" data-status="pending">
                        <i class="fas fa-clock me-1"></i>Pending
                    </button>
                    <button type="button" class="status-btn" data-status="in-progress">
                        <i class="fas fa-spinner fa-spin me-1"></i>In Progress
                    </button>
                    <button type="button" class="status-btn" data-status="completed">
                        <i class="fas fa-check-circle me-1"></i>Completed
                    </button>
                    <button type="button" class="status-btn" data-status="overdue">
                        <i class="fas fa-exclamation-triangle me-1"></i>Overdue
                    </button>
                </div>
            </div>
        </section>

        <!-- Assignments Grid -->
        <div class="row g-4" id="assignmentGrid">
            <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                <div class="assignment-card h-100" data-status="pending" data-deadline="2025-10-21" data-id="1">
                    <i class="fas fa-clock status-icon pending"></i>
                    <h3>Responsive Web Design Project</h3>
                    <span class="assignment-status status-pending">Pending</span>
                    <div class="priority high">
                        <i class="fas fa-exclamation-circle me-1"></i>High Priority
                    </div>
                    <div class="deadline">Due: <strong>Oct 21, 2025</strong></div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-pending" style="width: 0%"></div>
                    </div>
                    <div class="assignment-actions">
                        <button class="btn-action btn-view" data-assignment-id="1">
                            <i class="fas fa-eye me-1"></i>View
                        </button>
                        <button class="btn-action btn-mark-done" onclick="markAsDone(this)">
                            <i class="fas fa-check me-1"></i>Mark Done
                        </button>
                    </div>
                    <p class="assignment-date">Created: 10/10/2025</p>
                </div>
            </div>

            <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                <div class="assignment-card h-100 completed" data-status="completed" data-deadline="2025-10-15" data-id="2">
                    <i class="fas fa-check-circle status-icon completed"></i>
                    <h3>JavaScript Algorithms Challenge</h3>
                    <span class="assignment-status status-completed">Completed</span>
                    <div class="priority medium">
                        <i class="fas fa-star me-1"></i>Medium Priority
                    </div>
                    <div class="deadline">Due: <strong>Oct 15, 2025</strong></div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-completed" style="width: 100%"></div>
                    </div>
                    <div class="assignment-actions">
                        <button class="btn-action btn-view" data-assignment-id="2">
                            <i class="fas fa-eye me-1"></i>View
                        </button>
                    </div>
                    <p class="assignment-date">Completed: 10/14/2025</p>
                </div>
            </div>

            <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                <div class="assignment-card h-100 overdue" data-status="overdue" data-deadline="2025-10-13" data-id="3">
                    <i class="fas fa-exclamation-triangle status-icon overdue"></i>
                    <h3>CSS Grid Layout Assignment</h3>
                    <span class="assignment-status status-overdue">Overdue</span>
                    <div class="priority high">
                        <i class="fas fa-exclamation-circle me-1"></i>High Priority
                    </div>
                    <div class="deadline overdue">Due: <strong>Oct 13, 2025</strong></div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-overdue" style="width: 60%"></div>
                    </div>
                    <div class="assignment-actions">
                        <button class="btn-action btn-view" data-assignment-id="3">
                            <i class="fas fa-eye me-1"></i>View
                        </button>
                    </div>
                    <p class="assignment-date">Created: 10/05/2025</p>
                </div>
            </div>

            <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                <div class="assignment-card h-100" data-status="in-progress" data-deadline="2025-10-18" data-id="4">
                    <i class="fas fa-spinner fa-spin status-icon in-progress"></i>
                    <h3>React Components Development</h3>
                    <span class="assignment-status status-in-progress">In Progress</span>
                    <div class="priority medium">
                        <i class="fas fa-star me-1"></i>Medium Priority
                    </div>
                    <div class="deadline">Due: <strong>Oct 18, 2025</strong></div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-in-progress" style="width: 75%"></div>
                    </div>
                    <div class="assignment-actions">
                        <button class="btn-action btn-view" data-assignment-id="4">
                            <i class="fas fa-eye me-1"></i>View
                        </button>
                        <button class="btn-action btn-mark-done" onclick="markAsDone(this)">
                            <i class="fas fa-check me-1"></i>Mark Done
                        </button>
                    </div>
                    <p class="assignment-date">Started: 10/12/2025</p>
                </div>
            </div>
        </div>

        <!-- No results message -->
        <div class="row mt-4" id="noResults" style="display: none;">
            <div class="col-12 text-center">
                <div class="alert alert-info">
                    <i class="fas fa-clipboard-list fa-2x mb-3 d-block"></i>
                    <h4>No assignments found</h4>
                    <p>Try adjusting your search terms or status filters</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Assignment Detail Modal -->
    <div class="modal fade" id="assignmentDetailModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Assignment Details</h5>
                </div>
                <div class="modal-body">
                    <div id="assignmentDetailContent">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Assignment Mode Modal -->
    <div class="modal fade" id="assignmentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-tasks me-2"></i>Assignment Mode</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Activate focused assignment mode with timers, progress tracking, and distraction-free environment.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Start Assignment Mode</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentStatusFilter = 'all';
        let completedAssignments = new Set(JSON.parse(localStorage.getItem('completedAssignments')) || []);

        // Assignment questions data
        const assignmentQuestions = {
            1: "Create a fully responsive website using HTML, CSS, and JavaScript. The website should include a navigation menu, hero section, about page, services section, contact form, and footer. Ensure it works perfectly on desktop, tablet, and mobile devices. Use modern CSS Grid and Flexbox layouts, implement smooth animations, and make sure it's accessible and SEO-friendly.",
            2: "Implement a set of JavaScript algorithms including: 1) Palindrome checker, 2) FizzBuzz sequence generator, 3) Array manipulation functions (filter, map, reduce), 4) Binary search implementation, and 5) A simple calculator with error handling. Write clean, modular code with proper comments and test cases.",
            3: "Design a complex layout using CSS Grid that includes a header, sidebar navigation, main content area with cards, and footer. Implement responsive breakpoints for different screen sizes, add hover effects, and create a sticky navigation. Use CSS custom properties for theming and ensure cross-browser compatibility.",
            4: "Build reusable React components including: 1) A custom hook for data fetching, 2) A modal component with backdrop, 3) A form component with validation, 4) A card component with loading states, and 5) A navigation component with routing. Use Context API for state management and implement proper error boundaries."
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Status buttons
            const statusButtons = document.querySelectorAll('#statusButtons .status-btn');
            statusButtons.forEach(button => {
                button.addEventListener('click', function() {
                    statusButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    currentStatusFilter = this.getAttribute('data-status');
                    filterAndDisplayAssignments();
                });
            });

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(filterAndDisplayAssignments, 300));
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        filterAndDisplayAssignments();
                    }
                });
            }

            // View button click handler
            document.addEventListener('click', function(e) {
                if (e.target.closest('.btn-view')) {
                    e.preventDefault();
                    const button = e.target.closest('.btn-view');
                    const assignmentId = button.getAttribute('data-assignment-id');
                    const card = document.querySelector(`[data-id="${assignmentId}"]`);
                    showAssignmentModal(assignmentId, card);
                }
            });

            // Apply completed status from localStorage and update overdue
            document.querySelectorAll('.assignment-card').forEach(card => {
                const id = card.getAttribute('data-id');
                if (completedAssignments.has(id)) {
                    applyCompletedState(card);
                } else {
                    updateOverdueStatus(card);
                }
            });

            filterAndDisplayAssignments();
        });

        function showAssignmentModal(assignmentId, card) {
            const modal = new bootstrap.Modal(document.getElementById('assignmentDetailModal'), {
                backdrop: 'static',
                keyboard: false
            });
            
            const deadline = new Date(card.getAttribute('data-deadline'));
            const now = new Date();
            const title = card.querySelector('h3').textContent;
            const status = card.getAttribute('data-status');
            const priority = card.querySelector('.priority').textContent;
            const deadlineText = card.querySelector('.deadline').textContent;
            const question = assignmentQuestions[assignmentId] || "Assignment details not available.";

            document.getElementById('modalTitle').textContent = title;

            // ONLY show overdue warning for OVERDUE assignments that are NOT completed
            if (status === 'overdue' && !completedAssignments.has(assignmentId)) {
                document.getElementById('assignmentDetailContent').innerHTML = `
                    <div class="deadline-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>Assignment Overdue!</strong><br>
                            This assignment deadline has passed (${deadlineText}). You cannot access it anymore.
                        </div>
                    </div>
                `;
            } else if (completedAssignments.has(assignmentId)) {
                // Show submitted message for completed assignments
                document.getElementById('assignmentDetailContent').innerHTML = `
                    <div class="submitted-message">
                        <i class="fas fa-check-circle"></i>
                        <strong>You have successfully submitted this assignment!</strong>
                        <p>Great job completing "${title}" on time.</p>
                    </div>
                    <div class="assignment-question">
                        <strong>Assignment Question:</strong><br>
                        ${question}
                    </div>
                `;
            } else {
                // Show assignment question with mark done button
                let content = `
                    <div class="assignment-question">
                        <strong>Assignment Question:</strong><br>
                        ${question}
                    </div>
                    <p><strong>Priority:</strong> ${priority}</p>
                    <p><strong>Deadline:</strong> ${deadlineText}</p>
                `;

                // Only show mark done button if deadline not passed
                if (now <= deadline) {
                    content += `
                        <button class="mark-done-btn-modal" onclick="markAsDoneFromModal('${assignmentId}')" id="markDoneModalBtn">
                            <i class="fas fa-check me-2"></i>Mark as Completed
                        </button>
                    `;
                }

                document.getElementById('assignmentDetailContent').innerHTML = content;
            }

            modal.show();
        }

        function markAsDoneFromModal(assignmentId) {
            const card = document.querySelector(`[data-id="${assignmentId}"]`);
            markAsDone(card);
            
            // Update modal to show submitted message
            const title = card.querySelector('h3').textContent;
            const question = assignmentQuestions[assignmentId];
            document.getElementById('assignmentDetailContent').innerHTML = `
                <div class="submitted-message">
                    <i class="fas fa-check-circle"></i>
                    <strong>You have successfully submitted this assignment!</strong>
                    <p>Great job completing "${title}" on time.</p>
                </div>
                <div class="assignment-question">
                    <strong>Assignment Question:</strong><br>
                    ${question}
                </div>
            `;
            
            const btn = document.getElementById('markDoneModalBtn');
            if (btn) btn.remove();

            // Close modal after 3 seconds
            setTimeout(() => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('assignmentDetailModal'));
                if (modal) modal.hide();
            }, 3000);
        }

        function markAsDone(button) {
            const card = button.closest('.assignment-card');
            const id = card.getAttribute('data-id');
            const deadline = new Date(card.getAttribute('data-deadline'));
            const now = new Date();

            if (now > deadline) {
                alert('Cannot mark as done after deadline.');
                return;
            }

            completedAssignments.add(id);
            localStorage.setItem('completedAssignments', JSON.stringify([...completedAssignments]));
            applyCompletedState(card);
            filterAndDisplayAssignments();
        }

        function applyCompletedState(card) {
            const id = card.getAttribute('data-id');
            card.setAttribute('data-status', 'completed');
            card.classList.add('completed');
            card.classList.remove('overdue');
            
            const statusSpan = card.querySelector('.assignment-status');
            statusSpan.className = 'assignment-status status-completed';
            statusSpan.textContent = 'Completed';
            
            const icon = card.querySelector('.status-icon');
            icon.className = 'fas fa-check-circle status-icon completed';
            
            const progressFill = card.querySelector('.progress-fill');
            progressFill.style.width = '100%';
            progressFill.className = 'progress-fill progress-completed';
            
            // Remove mark done button
            const markBtn = card.querySelector('.btn-mark-done');
            if (markBtn) markBtn.remove();
        }

        function updateOverdueStatus(card) {
            const id = card.getAttribute('data-id');
            const deadline = new Date(card.getAttribute('data-deadline'));
            const now = new Date();
            
            // Only mark as overdue if not completed
            if (!completedAssignments.has(id) && now > deadline && card.getAttribute('data-status') !== 'completed') {
                card.setAttribute('data-status', 'overdue');
                card.classList.add('overdue');
                
                const statusSpan = card.querySelector('.assignment-status');
                statusSpan.className = 'assignment-status status-overdue';
                statusSpan.textContent = 'Overdue';
                
                const icon = card.querySelector('.status-icon');
                icon.className = 'fas fa-exclamation-triangle status-icon overdue';
                
                const progressFill = card.querySelector('.progress-fill');
                progressFill.className = 'progress-fill progress-overdue';
                
                const deadlineEl = card.querySelector('.deadline');
                deadlineEl.classList.add('overdue');
                
                // Remove mark done button for overdue
                const markBtn = card.querySelector('.btn-mark-done');
                if (markBtn) markBtn.remove();
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function filterAndDisplayAssignments() {
            const searchTerm = document.getElementById('searchInput')?.value.toLowerCase().trim() || '';
            const assignmentCards = document.querySelectorAll('#assignmentGrid .assignment-card');
            const visibleCards = [];
            
            assignmentCards.forEach(card => {
                const col = card.closest('.col');
                const cardStatus = card.getAttribute('data-status');
                const cardText = card.textContent.toLowerCase();
                
                const statusMatch = currentStatusFilter === 'all' || cardStatus === currentStatusFilter;
                const searchMatch = searchTerm === '' || cardText.includes(searchTerm);
                
                if (statusMatch && searchMatch) {
                    col.classList.remove('d-none');
                    visibleCards.push(card);
                } else {
                    col.classList.add('d-none');
                }
            });
            
            const noResults = document.getElementById('noResults');
            const assignmentGrid = document.getElementById('assignmentGrid');
            
            if (visibleCards.length === 0) {
                if (noResults) noResults.style.display = 'block';
                if (assignmentGrid) assignmentGrid.style.display = 'none';
            } else {
                if (noResults) noResults.style.display = 'none';
                if (assignmentGrid) assignmentGrid.style.display = 'block';
                equalizeCardHeights(visibleCards);
            }
        }

        function equalizeCardHeights(cards) {
            if (!cards || cards.length === 0) return;
            cards.forEach(card => card.style.height = 'auto');
            let maxHeight = 0;
            cards.forEach(card => maxHeight = Math.max(maxHeight, card.offsetHeight));
            cards.forEach(card => card.style.height = maxHeight + 'px');
        }

        // Navbar collapse outside click
        document.addEventListener('click', function(e) {
            const navbarCollapse = document.getElementById('navbarNav');
            if (navbarCollapse && !navbarCollapse.contains(e.target) && navbarCollapse.classList.contains('show')) {
                const bsCollapse = new bootstrap.Collapse(navbarCollapse, {toggle: false});
                bsCollapse.hide();
            }
        });

        // Check for overdue periodically
        setInterval(() => {
            document.querySelectorAll('.assignment-card').forEach(card => {
                const id = card.getAttribute('data-id');
                if (!completedAssignments.has(id)) {
                    updateOverdueStatus(card);
                }
            });
            filterAndDisplayAssignments();
        }, 60000); // Check every minute
    </script>
</body>
</html>